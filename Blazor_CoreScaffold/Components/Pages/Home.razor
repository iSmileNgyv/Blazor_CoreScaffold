@page "/" 
@rendermode InteractiveServer
@using Blazor_CoreScaffold.Components.Layout @* Added using for MainLayout *@

<PageTitle>System Health Dashboard</PageTitle>

<MudGrid Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center" Class="mb-6">
    <MudItem>
        <MudText Typo="Typo.h4" GutterBottom="true"><b>System Health Status</b></MudText>
        <MudText Typo="Typo.body1" Color="Color.Secondary">Last Updated: @LastUpdated</MudText>
    </MudItem>
    <MudItem>
        @* Status Chip - Removed Label="true" *@
        <MudChip T="object" Icon="@Icons.Material.Filled.CheckCircle" Color="Color.Success" Variant="Variant.Outlined">All Systems Operational</MudChip> @* Added T="object" *@
    </MudItem>
</MudGrid>

@* Stats Cards *@
<MudGrid Class="mb-6">
    <MudItem xs="12" sm="6" lg="4">
        <MudPaper Class="pa-6 rounded-lg" Elevation="0" Style="@($"border: 1px solid {BorderColor};")">
            <MudText Typo="Typo.body1" Class="mud-text-secondary mb-2">System Uptime</MudText>
            <MudText Typo="Typo.h5" Class="mb-1"><b>99.98%</b></MudText>
            <MudText Typo="Typo.body1" Style="color: var(--mud-palette-success);">+0.01%</MudText>
        </MudPaper>
    </MudItem>
    <MudItem xs="12" sm="6" lg="4">
        <MudPaper Class="pa-6 rounded-lg" Elevation="0" Style="@($"border: 1px solid {BorderColor};")">
            <MudText Typo="Typo.body1" Class="mud-text-secondary mb-2">Database Status</MudText>
            <MudText Typo="Typo.h5" Style="color: var(--mud-palette-success);" Class="mb-1"><b>Connected</b></MudText>
            <MudText Typo="Typo.body1" Class="mud-text-secondary">Avg Latency: 12ms</MudText>
        </MudPaper>
    </MudItem>
    <MudItem xs="12" sm="12" lg="4"> @* Take full width on sm if only 3 items *@
        <MudPaper Class="pa-6 rounded-lg" Elevation="0" Style="@($"border: 1px solid {BorderColor};")">
            <MudText Typo="Typo.body1" Class="mud-text-secondary mb-2">Message Broker</MudText>
            <MudText Typo="Typo.h5" Style="color: var(--mud-palette-success);" Class="mb-1"><b>Healthy</b></MudText>
            <MudText Typo="Typo.body1" Class="mud-text-secondary">0 pending messages</MudText>
        </MudPaper>
    </MudItem>
</MudGrid>

@* Charts (Placeholders) *@
<MudGrid Class="mb-6">
    <MudItem xs="12" lg="6">
        <MudPaper Class="pa-6 rounded-lg d-flex flex-column" Style="@($"border: 1px solid {BorderColor}; min-height: 350px;")" Elevation="0">
            <MudText Typo="Typo.body1" Class="mud-text-secondary">API Response Times (p95)</MudText>
            <MudText Typo="Typo.h4" Class="mb-0"><b>128ms</b></MudText>
            <div class="d-flex gap-1">
                <MudText Typo="Typo.body1" Class="mud-text-secondary">Last Hour</MudText>
                <MudText Typo="Typo.body1" Style="color: var(--mud-palette-error);">+2.1%</MudText>
            </div>
            <div class="flex-grow-1 d-flex align-center justify-center">
                @* Placeholder for Chart *@
                <MudText>API Response Chart Placeholder</MudText>
            </div>
        </MudPaper>
    </MudItem>
    <MudItem xs="12" lg="6">
        <MudPaper Class="pa-6 rounded-lg d-flex flex-column" Style="@($"border: 1px solid {BorderColor}; min-height: 350px;")" Elevation="0">
            <MudText Typo="Typo.body1" Class="mud-text-secondary">CPU Usage</MudText>
            <MudText Typo="Typo.h4" Class="mb-0"><b>34%</b></MudText>
            <div class="d-flex gap-1">
                <MudText Typo="Typo.body1" Class="mud-text-secondary">Last Hour</MudText>
                <MudText Typo="Typo.body1" Style="color: var(--mud-palette-success);">-5.3%</MudText>
            </div>
            <div class="flex-grow-1 d-flex align-center justify-center">
                @* Placeholder for Chart *@
                <MudText>CPU Usage Chart Placeholder</MudText>
            </div>
        </MudPaper>
    </MudItem>
</MudGrid>

@* Service List *@
<MudText Typo="Typo.h6" GutterBottom="true" Class="mb-4"><b>Critical Services</b></MudText>
<MudPaper Class="pa-4 rounded-lg" Elevation="0" Style="@($"border: 1px solid {BorderColor};")">
    <MudList T="object" Clickable="false"> @* Added T="object" *@
        <MudListItem T="object" Class="list-item-custom"> @* Added T="object" *@
            <MudText>Authentication Service</MudText>
            <MudChip T="object" Icon="@Icons.Material.Filled.FiberManualRecord" Color="Color.Success" Size="Size.Small">Operational</MudChip> @* Added T="object", Removed Label="true" *@
        </MudListItem>
        <MudDivider />
        <MudListItem T="object" Class="list-item-custom"> @* Added T="object" *@
            <MudText>Caching Layer (Redis)</MudText>
            <MudChip T="object" Icon="@Icons.Material.Filled.FiberManualRecord" Color="Color.Success" Size="Size.Small">Operational</MudChip> @* Added T="object", Removed Label="true" *@
        </MudListItem>
        <MudDivider />
        <MudListItem T="object" Class="list-item-custom"> @* Added T="object" *@
            <MudText>Email Service</MudText>
            <MudChip T="object" Icon="@Icons.Material.Filled.FiberManualRecord" Color="Color.Warning" Size="Size.Small">Degraded Performance</MudChip> @* Added T="object", Removed Label="true" *@
        </MudListItem>
        <MudDivider />
        <MudListItem T="object" Class="list-item-custom"> @* Added T="object" *@
            <MudText>Search Indexing</MudText>
            <MudChip T="object" Icon="@Icons.Material.Filled.FiberManualRecord" Color="Color.Error" Size="Size.Small">Outage</MudChip> @* Added T="object", Removed Label="true" *@
        </MudListItem>
        <MudDivider />
        <MudListItem T="object" Class="list-item-custom"> @* Added T="object" *@
            <MudText>Background Jobs</MudText>
            <MudChip T="object" Icon="@Icons.Material.Filled.FiberManualRecord" Color="Color.Success" Size="Size.Small">Operational</MudChip> @* Added T="object", Removed Label="true" *@
        </MudListItem>
    </MudList>
</MudPaper>

@* Optional Custom CSS for list item alignment *@
<style>
    .list-item-custom {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .mud-chip .mud-chip-label { /* Target label inside chip correctly */
        font-size: 0.75rem !important; /* Use !important if needed to override */
        line-height: 1.2; /* Adjust line-height if text is cut */
    }
    .mud-chip.mud-chip-size-small { /* Adjust padding for small chips */
        padding: 2px 6px;
        height: 20px;
    }
    .mud-chip .mud-icon-root.mud-icon-size-small { /* Adjust icon size in small chip */
        font-size: 1rem;
    }
</style>


@code {
    [CascadingParameter]
    private MainLayout? Layout { get; set; } // Access Layout parameter if needed

    private string LastUpdated { get; set; } = "a few seconds ago"; // Make dynamic later

    // Determine border color based on theme
    private string BorderColor => Layout?._isDarkMode == true ? "var(--mud-palette-lines-default)" : "var(--mud-palette-lines-inputs)";

    // TODO: Load actual data for stats, charts, and service status

    protected override void OnInitialized()
    {
        // Add null check for Layout
        // BorderColor calculation depends on Layout, ensure it's accessed safely
    }
}

